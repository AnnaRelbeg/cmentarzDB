<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil osoby</title>
  <link rel="icon" href="assets/images/2.png" type="image/png">
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    body {
      background: url('assets/images/black_redflower.jpeg') no-repeat center center fixed;
      background-size: cover;
      background-attachment: scroll; /* prevents weird behaviour on mobile */
      font-family: 'Open Sans', sans-serif;
      color: #2f2f2f;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
  
    @media (max-width: 768px) {
      body {
        background-attachment: scroll;
        background-position: center top;
      }
    }
    
    /* ---------------------------------
       Slide Show 
    ---------------------------------*/
    /* Slideshow Styles */
    .slideshow-container {
      position: fixed; /* Set the slideshow container to a fixed position */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1; /* Place it behind the content */
      overflow: hidden; /* Hide overflow */
  }

  .mySlides {
      max-width: 100%;
      position: absolute; /* Position slides absolutely within the container */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
  }

  img {
      width: 100%;
      height: 100%;
      object-fit: cover; /* Ensure images cover the entire container */
  }

  .slideshow-text {
      /* Your text styles for the slides */
      color: #fff;
      text-align: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%); /* Center text vertically and horizontally */
  }
  </style>
  

</head>
<body>
  <!-- Move the slideshow-container outside of the main section -->
  <div class="slideshow-container">
    <!-- Slides for the image slideshow -->
    <div class="mySlides fade">
        <img src="assets/images/black_flower.jpeg" alt="Slideshow Image 1">
    </div>
    <div class="mySlides fade">
        <img src="assets/images/black_flower.jpeg" alt="Slideshow Image 2">
    </div>
    <!-- Add more slides as needed -->
</div>

<audio id="background-music" loop>
  <source src="assets/images/KevinMacLeod.mp3" type="audio/mpeg">
  Twoja przeglƒÖdarka nie obs≈Çuguje audio.
</audio>

<!-- Play button -->
<button id="play-music-btn" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #6a8b5f;
  color: white;
  border: none;
  padding: 0.75rem 1.2rem;
  font-size: 1rem;
  border-radius: 12px;
  cursor: pointer;
  z-index: 1000;
">
  üéµ W≈ÇƒÖcz muzykƒô
</button>

  <div id="profile-container">
    <h1 id="profile-name">≈Åadowanie...</h1>
    <div class="swiper profileSwiper">
        <div class="swiper-wrapper" id="profile-gallery">
          <!-- Slides will be inserted here -->
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
      </div>      
    <p><strong>ID osoby:</strong> <span id="profile-id"></span></p>
    <p><strong>ID grobu:</strong> <span id="profile-location"></span></p>
    <p><strong>Data urodzenia:</strong> <span id="profile-birth"></span></p>
    <p><strong>Data ≈õmierci:</strong> <span id="profile-death"></span></p>
    <p><strong>Wiek:</strong> <span id="profile-age"></span> lat</p>
    <p id="profile-description"></p>
    <div id="profile-memory">
        <h2>Wspomnienie</h2>
        <p id="profile-memory-text">Brak wspomnienia.</p>
        <p id="memory-success" style="color: green; display: none; margin-top: 1rem;">Dziƒôkujemy za dodanie wspomnienia!</p>
        
    </div>
    <div id="candles-section" style="margin-top: 2rem; text-align: center;">
      <h2>Zapal znicz</h2>
      <button id="light-candle-btn" style="
        background-color: #f4a261;
        color: white;
        padding: 0.6rem 1.4rem;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
      ">
        üïØÔ∏è Zapal znicz
      </button>
      <div id="candle-display" style="margin-top: 1.5rem; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;"></div>
    </div>
    
      <div id="photo-upload" style="margin-top: 2.5rem; text-align: center;">
        <h2 style="margin-bottom: 0.5rem;">Dodaj zdjƒôcie</h2>
        <p style="margin-bottom: 1rem;">Je≈õli posiadasz zdjƒôcie tej osoby, mo≈ºesz je przes≈Çaƒá tutaj:</p>
        <form id="upload-form">
          <!-- Hidden native input -->
          <input type="file" id="photo-file" accept="image/*" required style="display: none;" />
          
          <!-- Styled label acting as button -->
          <label for="photo-file" style="
            display: inline-block;
            background-color: #9fb89d;
            color: white;
            padding: 0.5rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 1rem;
          ">üì∑ Wybierz zdjƒôcie</label>
      
          <br />
      
          <!-- Submit button -->
          <button type="submit" style="
            background-color: #6a8b5f;
            color: white;
            padding: 0.5rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
          ">Prze≈õlij zdjƒôcie</button>
      
          <p id="upload-placeholder-msg" style="margin-top: 1rem; color: #999;">
          </p>
        </form>
      </div>
      
      
            
    <a class="back-button" href="index.html">‚Üê Powr√≥t</a>
  </div>
  <!-- Lightbox -->
<div class="image-lightbox" id="lightbox">
  <img id="lightbox-img" src="" alt="Pe≈Çne zdjƒôcie" />
</div>

<script>
  document.getElementById('play-music-btn').addEventListener('click', () => {
    const audio = document.getElementById('background-music');
    audio.play();
    document.getElementById('play-music-btn').style.display = 'none';
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");

    document.getElementById("profile-gallery").addEventListener("click", (e) => {
      if (e.target.tagName === "IMG") {
        lightbox.style.display = "flex";
        lightboxImg.src = e.target.src;
      }
    });

    lightbox.addEventListener("click", () => {
      lightbox.style.display = "none";
      lightboxImg.src = "";
    });
  });
</script>

  <script>// Slideshow
    let slideIndex = 0;
    function showSlides() {
        const slides = document.getElementsByClassName("mySlides");
        for (let i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        slideIndex = (slideIndex + 1) % slides.length;
        slides[slideIndex].style.display = "block";
        setTimeout(showSlides, 2000000);
    }
    showSlides();
    </script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyChVtFHlA4mDuwx-xi7jLGMWvNYcNrrANM",
      authDomain: "cmentarz-dabrowki.firebaseapp.com",
      projectId: "cmentarz-dabrowki",
      storageBucket: "cmentarz-dabrowki.appspot.com",
      messagingSenderId: "502809191219",
      appId: "1:502809191219:web:9526a28823974e90c91446",
      measurementId: "G-GEDTJPLZ87"
    };
  
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
  
    const params = new URLSearchParams(window.location.search);
    const personId = params.get("id");
  
    const galleryContainer = document.getElementById("profile-gallery");
  
    if (personId) {
      const docRef = doc(db, "zmarli", personId);
      getDoc(docRef).then(docSnap => {
        if (docSnap.exists()) {
          const data = docSnap.data();
  
          document.getElementById("profile-name").textContent = data.fullName;
          document.getElementById("profile-id").textContent = data.id;
          document.getElementById("profile-location").textContent = data.location
          document.getElementById("profile-birth").textContent = data.birthDate;
          document.getElementById("profile-death").textContent = data.deathDate;
          document.getElementById("profile-age").textContent = data.age;
          document.getElementById("profile-description").textContent = data.description;
          document.getElementById("profile-memory-text").textContent = data.memoryText || "Brak wspomnienia.";
  
          if (data.photoGallery?.length) {
            data.photoGallery.forEach((url) => {
              const slide = document.createElement("div");
              slide.classList.add("swiper-slide");
              slide.innerHTML = `<img src="${url}" alt="${data.fullName}" />`;
              galleryContainer.appendChild(slide);
            });
  
            new Swiper(".profileSwiper", {
              loop: true,
              autoplay: {
                delay: 5000,
                disableOnInteraction: false
              },
              effect: "fade",
              fadeEffect: {
                crossFade: true
              },
              pagination: {
                el: ".swiper-pagination",
                clickable: true
              },
              navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev"
              }
            });
          }
  
          // Memory form submission handling
          const memoryForm = document.createElement("form");
          memoryForm.id = "memory-form";
          memoryForm.style.marginTop = "1.5rem";
          memoryForm.innerHTML = `
  <textarea id="memory-input" rows="4" placeholder="Dodaj swoje wspomnienie..." required style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid #ccc;"></textarea>
  <button type="submit" style="margin-top: 0.75rem; background-color: #6a8b5f; color: white; padding: 0.5rem 1rem; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Zapisz wspomnienie</button>
  <p id="memory-success" style="color: green; display: none; margin-top: 1rem;">Dziƒôkujemy za dodanie wspomnienia!</p>
`;

          document.getElementById("profile-memory").appendChild(memoryForm);
  
          memoryForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const memoryInput = document.getElementById("memory-input");
            const memorySuccess = document.getElementById("memory-success");
            const memoryText = memoryInput.value.trim();
            if (!memoryText) return;
  
            try {
              await updateDoc(docRef, { memoryText });
              document.getElementById("profile-memory-text").textContent = memoryText;
              memoryInput.value = "";
              memorySuccess.style.display = "block";
            } catch (error) {
              alert("WystƒÖpi≈Ç b≈ÇƒÖd podczas zapisywania wspomnienia. Spr√≥buj ponownie.");
              console.error(error);
            }
          });
  
        } else {
          document.getElementById("profile-name").textContent = "Nie znaleziono profilu.";
        }
      });
    } else {
      document.getElementById("profile-name").textContent = "Brak ID profilu w adresie URL.";
    }
  </script>
  
  
</body>
</html>
